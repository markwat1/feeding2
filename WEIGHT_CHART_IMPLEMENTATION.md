# ペット体重グラフ機能の実装

## 概要

ペット管理システムに体重の推移をグラフで表示する機能を追加しました。この機能により、各ペットの体重変化を視覚的に確認できるようになります。

## 実装された機能

### 1. 体重グラフ表示
- 各ペットの体重記録を折れ線グラフで表示
- 測定日順にデータポイントを表示
- グラフにはホバー時の詳細情報表示機能付き

### 2. 期間選択機能
- **直近1ヶ月**: 過去1ヶ月間の体重記録を表示
- **直近3ヶ月**: 過去3ヶ月間の体重記録を表示
- **直近6ヶ月**: 過去6ヶ月間の体重記録を表示（デフォルト）
- **直近1年**: 過去1年間の体重記録を表示
- **全期間**: すべての体重記録を表示

### 3. ユーザーインターフェース
- ペット管理ページでペットを選択すると自動的にグラフが表示
- 期間選択ドロップダウンで表示期間を変更可能
- レスポンシブデザインでモバイル端末にも対応

## 新しく追加されたファイル

### フロントエンド
1. **`client/src/components/common/WeightChart.tsx`**
   - Chart.jsを使用した体重グラフコンポーネント
   - 体重データの可視化とインタラクション機能

2. **`client/src/components/common/WeightChart.module.css`**
   - グラフコンポーネントのスタイリング

3. **`client/src/components/common/PeriodSelector.tsx`**
   - 期間選択用のドロップダウンコンポーネント

4. **`client/src/components/common/PeriodSelector.module.css`**
   - 期間選択コンポーネントのスタイリング

5. **`client/src/utils/dateUtils.ts`**
   - 日付計算とフィルタリング用のユーティリティ関数

### 依存関係
- **chart.js**: グラフ描画ライブラリ
- **react-chartjs-2**: React用Chart.jsラッパー

## 変更されたファイル

### フロントエンド
1. **`client/package.json`**
   - Chart.js関連の依存関係を追加

2. **`client/src/components/PetManagement.tsx`**
   - 体重グラフ表示機能を統合
   - 期間選択機能を追加
   - 状態管理の拡張

3. **`client/src/components/PetManagement.module.css`**
   - グラフセクション用のスタイルを追加

## セットアップ手順

### 1. 依存関係のインストール
```bash
# ルートディレクトリから実行
./install_chart_dependencies.sh

# または手動でインストール
cd client
npm install chart.js@^4.4.0 react-chartjs-2@^5.2.0
```

### 2. 開発サーバーの起動
```bash
# ルートディレクトリから実行
npm run dev
```

### 3. 機能の確認
1. ブラウザで http://localhost:3000 にアクセス
2. ナビゲーションから「ペット管理」を選択
3. ペットを選択すると体重グラフが表示される
4. 期間選択ドロップダウンで表示期間を変更可能

## 使用方法

### 基本的な使用手順
1. **ペット管理ページにアクセス**
   - ナビゲーションメニューから「ペット管理」を選択

2. **ペットの選択**
   - ペット一覧からグラフを表示したいペットを選択
   - 選択すると自動的に直近6ヶ月の体重グラフが表示される

3. **期間の変更**
   - グラフ上部の「表示期間」ドロップダウンから期間を選択
   - 選択した期間に応じてグラフが更新される

4. **グラフの操作**
   - データポイントにマウスを合わせると詳細情報が表示
   - グラフは自動的にスケールが調整される

### 体重記録の追加
- 新しい体重記録を追加すると、グラフも自動的に更新される
- 記録は測定日順に表示される

## 技術仕様

### グラフライブラリ
- **Chart.js 4.4.0**: 高性能なHTML5キャンバスベースのグラフライブラリ
- **react-chartjs-2 5.2.0**: React用のChart.jsラッパー

### データフィルタリング
- クライアントサイドでの期間フィルタリング
- 既存のAPIエンドポイントを活用
- 効率的なデータ処理

### レスポンシブデザイン
- モバイル端末での表示に最適化
- タッチ操作に対応
- 画面サイズに応じたレイアウト調整

## API エンドポイント

既存のAPIエンドポイントを使用：
- `GET /api/pets/:id/weights` - ペットの体重記録取得
- `GET /api/weight-records` - 日付範囲での体重記録取得

## エラーハンドリング

### 表示される状況
- **データなし**: 選択した期間に体重記録がない場合
- **読み込み中**: データ取得中の表示
- **エラー**: API通信エラー時のメッセージ表示

## パフォーマンス考慮事項

### 最適化された処理
- クライアントサイドでのデータフィルタリング
- 必要最小限のAPI呼び出し
- 効率的な再レンダリング

### メモリ使用量
- Chart.jsの適切な初期化と破棄
- 不要なデータの自動クリーンアップ

## 今後の拡張可能性

### 追加可能な機能
1. **複数ペット比較**: 複数のペットの体重を同一グラフで比較
2. **目標体重設定**: 目標体重ラインの表示
3. **統計情報**: 平均体重、増減率などの統計表示
4. **エクスポート機能**: グラフのPNG/PDF出力
5. **アラート機能**: 急激な体重変化の通知

### カスタマイズ
- グラフの色やスタイルの変更
- 表示期間の追加（2週間、2ヶ月など）
- データポイントの表示形式変更

## トラブルシューティング

### よくある問題

1. **グラフが表示されない**
   - Chart.js依存関係がインストールされているか確認
   - ブラウザのコンソールでエラーを確認

2. **期間選択が動作しない**
   - 体重記録が存在するか確認
   - 選択した期間にデータがあるか確認

3. **パフォーマンスの問題**
   - 大量のデータがある場合は期間を短くして確認
   - ブラウザのメモリ使用量を確認

### デバッグ方法
```javascript
// ブラウザのコンソールで実行
console.log('Weight records:', weightRecords);
console.log('Filtered records:', getFilteredWeightRecords());
```

## まとめ

この実装により、ペットの体重管理がより効果的に行えるようになりました。視覚的なグラフ表示により、体重の変化傾向を素早く把握でき、ペットの健康管理に役立ちます。

既存の機能を損なうことなく新機能を追加し、直感的で使いやすいインターフェースを提供しています。